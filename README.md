# 木马

## 根据开源的木马

computer => 程序（后续）

linux

- windows
  - 功能 Windows API === Windows 核心编程
  - 进程，线程 + 内核（rootkit）
  - 木马样本
    - 逆向
      - 工具的使用（IDA、OD 32位、X64DBG 64位、Windbg（强）、gdb、ildb）
        - script 脚本 一次性下很多断点
      - 理解代码
        - A、B、C、三个木马样本（找ABC 共同实现的功能）
          - ===》大多数木马都需要去实现某个功能 | 看代码
            - API的组合 是X+Y+Z 去实现某个功能
        - F5 不能使用：汇编指令 + 寄存器 + 堆栈 
          - 《汇编语言》王爽
          - 如果有代码特别难懂 OD
        - 《逆向工程核心原理》
        - 文件格式 PE 头
    - 木马 功能的叠加
      - 实现A功能
      - B
      - C

## 实现一个木马界的hello world

根据最简单的木马

头文件

main==>函数

字符串



木马界最简单的 程序 再分析

https://bbs.kanxue.com/new-digest.htm

- 木马的推荐
  - 开源
  - 简单的木马
  - 源码层次 VS 反汇编形式 ==> 一 一对比
  - 特性总结
    - 隐蔽性 ==》 不同的技术手段

## 免杀的实现

1. 发现我
   1. 内核信息：存了多少个进程，更改内核信息
2. 杀了我
   1. 权限、root
   2. 金蝉脱壳：A <=> B（木马）A \B 进程很像 ，杀掉了A
   3. 杀毒软件的漏洞
      1. 

# 木马综述

## 分类

1. 软件 & 硬件：软件

2. 根据功能：挖矿；破坏

## 经典木马

在Linux系统中，木马的设计和架构多种多样，反映了攻击者的不同目的和技术水平。下面列举几个具有代表性的Linux木马，这些木马在历史上曾造成重大影响或在技术上具有创新性：

### 1. **Mirai**

1. **DDoS木马**：
   - 设计用来进行分布式拒绝服务攻击（DDoS）。这类木马将受感染的机器变成“僵尸”计算机，用来对目标网站或服务发起大规模的流量攻击。
   - 例子：**Mirai** 及其变种，虽然主要感染的是物联网设备，但也有针对Linux服务器的版本，利用它们进行大规模的DDoS攻击。

- **架构特点**：Mirai是一个著名的物联网（IoT）僵尸网络木马，主要感染基于Linux的IoT设备。Mirai的主要特点是能够自动搜索和感染具有弱或默认密码的设备，然后利用这些设备发起分布式拒绝服务攻击（DDoS）。
- **影响**：Mirai曾在2016年通过大规模DDoS攻击导致多个大型网站和服务不可用，包括Twitter、Netflix和Reddit等。

### 2. **Bashlite**

- **架构特点**：Bashlite（又名Gafgyt、LizardStresser）也是针对IoT设备的Linux木马，其利用脚本简化了攻击过程，主要通过已知漏洞感染设备，如Shellshock漏洞。
- **影响**：Bashlite主要用于组建僵尸网络，进行DDoS攻击，影响了大量的网络摄像头和路由器。

### 3. **Rex Linux Trojan**

- **架构特点**：Rex是一个复杂的恶意软件家族，功能包括DDoS攻击、比特币挖矿和勒索软件。它通过利用Drupal CMS的漏洞感染服务器。
- **影响**：Rex可以通过勒索邮件威胁受害者支付比特币，否则就发起DDoS攻击。

### 4. **Umbreon**

- **架构特点**：Umbreon是一个rootkit，以宠物小精灵中的暗影月亮伞兵命名。它能在Linux系统上深度隐藏，难以被发现，可以拦截系统调用，隐藏恶意进程和文件。
- **影响**：Umbreon专为持久性设计，能够在被感染的系统上长期存活，且难以被普通的安全工具检测到。

### 5. **Ebury**

- **架构特点**：Ebury是一个SSH木马，可以窃取凭据并允许攻击者远程控制感染的服务器。
- **影响**：Ebury主要用于建立持久的控制网络，攻击者通过窃取SSH凭据轻松地管理和扩展其控制的服务器网络。

这些例子展示了Linux下木马的多样性，从利用IoT设备发动DDoS攻击的Mirai和Bashlite，到复杂的勒索软件和比特币挖矿程序如Rex，再到难以检测的rootkit如Umbreon和操控SSH服务的Ebury，各有不同的侧重点和技术手段。这些木马的存在和发展不断提示着Linux系统管理员必须采取严格的安全措施，包括定期更新和加强密码管理，以抵御这些威胁。

Drovorub 是一个由俄罗斯军事情报部门（GRU）使用的高级恶意软件套件，主要针对Linux系统。美国国家安全局（NSA）和联邦调查局（FBI）在2020年共同发布了关于Drovorub的详细报告，警告这种工具的潜在威胁。Drovorub 包含多个组件，它们协同工作以便入侵、控制、操纵和窃取受害者网络上的信息。

### Drovorub

**Rootkit木马**：

- Rootkits旨在隐藏其存在及其在受感染系统上活动的痕迹。它们通常获得最高权限，并深入系统内核，使检测和移除变得极其困难。
- 例子：**Drovorub**，针对Linux系统的一个复杂rootkit，由俄罗斯APT组织使用，可以进行远程控制和数据窃取。

#### 主要组件

1. **客户端（Client）**:
   - Drovorub客户端安装在被攻击的Linux机器上。它负责与服务器（控制器）建立连接，并接受来自攻击者的命令。客户端能执行的命令包括执行文件、操控文件系统、转发网络流量等。
2. **服务器（Server）**:
   - 服务器端运行于攻击者控制的机器上，用于管理所有感染的客户端。服务器可以下达命令、接收数据，并管理与客户端的通信。
3. **代理（Agent）**:
   - Drovorub代理部署在受害者网络中，用于桥接内部网络和攻击者的服务器。代理能够处理网络流量的转发，使攻击者能够访问和操控网络中的其他系统。
4. **文件传输与管理模块**:
   - 这一模块使得攻击者能够上传和下载文件，管理文件系统中的文件和目录。

#### 架构和实现细节

- **隐蔽性**： Drovorub使用多种技术来隐藏其在系统上的存在，包括利用rootkit技术深入系统内核。这使得它能够避开传统的安全检测和防御措施。
- **通信**： 客户端与服务器之间的通信通常通过加密的WebSocket连接实现，这提高了数据传输的安全性，并使通信难以被侦测。
- **持久性**： Drovorub利用多种机制保持其在系统上的持久性，包括修改系统启动配置文件，以确保在系统重启后自动运行。
- **操作系统内核模块**： Drovorub的rootkit功能是通过一个内核模块实现的，该模块在系统上加载并运行，能够拦截和修改系统调用，隐藏恶意活动的痕迹。

Drovorub 是由俄罗斯GRU的85号主要特别服务中心，通常称为APT28，创建的一套用于开发Linux操作系统恶意软件的工具包。根据提供的资料，Drovorub 的架构包含以下几个关键组件：

植入模块 (Implant)：这是Drovorub系统中的客户端部分，当部署在受害者机器上时，该植入模块能够与攻击者进行直接通信。

内核模块Rootkit：这是一个高度隐蔽的组件，用于隐藏恶意活动和维持持久性。通过操作内核级功能，rootkit能够掩盖恶意进程的运行，避免被安全软件检测到。

文件传输和端口转发工具：这些工具支持攻击者与被感染系统之间的数据传输，包括文件上传和下载，以及网络流量的重定向，使攻击者能够利用受害者的网络资源进行其他恶意活动。

命令与控制（C2）服务器：作为整个Drovorub恶意软件工具集的协调中心，C2服务器负责接收来自植入模块的数据，发送指令和管理被感染的设备。这使得攻击者可以远程控制受害者的机器，并执行进一步的恶意行为或窃取信息。

总的来说，Drovorub是一个复杂的恶意软件生态系统，其多层次组件合作，为攻击者提供了广泛的控制手段和强大的隐蔽性。这种架构使得Drovorub成为一个针对Linux系统的有效且难以侦测的威胁工具。

## 编写

要构造自己的Linux木马，首先需要了解基础的Linux系统编程和网络编程知识。构建一个Linux木马通常涉及以下几个步骤：

1. **规划木马功能**：确定你想要木马执行的具体任务（如反向连接、文件操作、数据窃取等）。
2. **编写恶意代码**：
   - 使用C语言或其他适合的编程语言编写恶意代码。根据木马的目标功能，可能包括socket编程用于网络通信，系统调用修改系统配置或访问敏感信息。
   - 常见的木马类型有`bind_shell`和`reverse_shell`。`bind_shell`木马在被攻击的机器上打开一个端口，等待攻击者的连接。`reverse_shell`木马则主动连接到攻击者预设的服务器。
3. **编译木马程序**：
   - 使用gcc等编译器对源代码进行编译，生成可执行文件。例如，命令 `gcc -o my_trojan my_trojan.c` 可以将C语言写的木马源码编译成名为`my_trojan`的执行文件。
4. **测试木马效果**：在安全的环境中测试木马的功能是否符合预期，确保没有错误。
5. **反编译和分析**：
   - 使用工具如objdump或gdb对编译后的木马进行反编译，分析其汇编指令，确保没有安全漏洞。检查关键的系统调用，如`setreuid`, `execve`, `socketcall`等，确保它们的使用正确且无法被轻易追踪。
6. **部署木马**：
   - 将木马部署到目标机器上。这一步应当在确保合法和遵守道德的前提下进行。

请注意，创建和使用木马软件通常与黑客活动相关联，并且在大多数国家都是非法的。确保你的行为符合当地法律和道德标准。此外，本文仅出于教育目的讨论此内容，请勿用于非法用途。
